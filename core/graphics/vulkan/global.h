// limztudio@gmail.com
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#pragma once


#include <core/global.h>

#include <core/graphics/common.h>

#if defined(NWB_PLATFORM_WINDOWS)
#define VK_USE_PLATFORM_WIN32_KHR
#elif defined(NWB_PLATFORM_LINUX)
#define VK_USE_PLATFORM_XCB_KHR
#elif defined(NWB_PLATFORM_ANDROID)
#define VK_USE_PLATFORM_ANDROID_KHR
#elif defined(NWB_PLATFORM_APPLE)
#define VK_USE_PLATFORM_METAL_EXT
#endif

#include <volk/volk.h>


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#define NWB_VULKAN_BEGIN NWB_CORE_BEGIN namespace Vulkan{
#define NWB_VULKAN_END }; NWB_CORE_END


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_CORE_BEGIN


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


namespace ObjectTypes{
    constexpr ObjectType NWB_VK_Device = 0x00030101;
};


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_CORE_END


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_VULKAN_BEGIN


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


constexpr u32 s_MinimumVersion = static_cast<u32>(VK_MAKE_API_VERSION(0, 1, 3, 0));

constexpr u32 s_AppVersion = static_cast<u32>(VK_MAKE_API_VERSION(0, 1, 0, 0));
constexpr u32 s_EngineVersion = static_cast<u32>(VK_MAKE_API_VERSION(0, 1, 0, 0));
constexpr const char* s_AppName = "NWBLot";

constexpr u64 s_DefaultUploadChunkSize = 64 * 1024 * 1024; // 64 MB
constexpr u64 s_DefaultScratchChunkSize = 16 * 1024 * 1024; // 16 MB
constexpr u64 s_ScratchMemoryLimit = 256 * 1024 * 1024; // 256 MB
constexpr u64 s_LargeBufferThreshold = 16 * 1024 * 1024; // 16 MB

constexpr u64 s_BufferAlignmentBytes = 4;


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


template<typename T, typename U>
inline T checked_cast(U u){
    static_assert(!IsSame<T, U>::value, "Unnecessary checked_cast");
    if(!u)
        return nullptr;
    T t = static_cast<T>(u);
#ifdef NWB_DEBUG
    NWB_ASSERT(t);
#endif
    return t;
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_VULKAN_END


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

