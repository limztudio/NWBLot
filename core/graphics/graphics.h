// limztudio@gmail.com
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#pragma once


#include "common.h"


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_CORE_BEGIN


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


class Graphics{
private:
    static constexpr u32 s_DynamicAllocatorSize = 64 * 1024 * 1024;
    static constexpr u32 s_ReservedPerformanceCoresForMainThread = 1;


public:
    Graphics();
    ~Graphics();


public:
    bool init(const Common::FrameData& data);
    bool runFrame();
    void updateWindowState(u32 width, u32 height, bool windowVisible, bool windowIsInFocus);
    void destroy();

public:
    [[nodiscard]] GraphicsAllocator& getAllocator()noexcept{ return m_allocator; }
    [[nodiscard]] IDeviceManager* getDeviceManager()const noexcept{ return m_deviceManager; }


private:
    static u32 queryGraphicsWorkerThreadCount();


private:
    GraphicsAllocator m_allocator;
    Alloc::ThreadPool m_threadPool;
    DeviceCreationParameters m_deviceCreationParams;

private:
    IDeviceManager* m_deviceManager = nullptr;
};


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_CORE_END


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

