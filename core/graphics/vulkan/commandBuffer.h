// limztudio@gmail.com
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#pragma once


#include "../common.h"
#include "config.h"

#include "dataStructures.h"
#include "primitiveAssets.h"


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_CORE_BEGIN


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


template <typename PoolArena>
class CommandBuffer{
private:
    VkCommandBuffer m_vkCommandBuffer;

    VkDescriptorPool m_vkDescriptorPool;
    ResourcePoolAny<PoolArena> m_descriptorSets;
    
    VkDescriptorSet m_vkDescriptorSets[16];
    
    RenderPass* m_currentRenderPass = nullptr;
    Pipeline* m_currentPipeline = nullptr;
    VkClearValue m_vkClears[2]; // 0 = color, 1 = depthStencil
    bool m_isRecording = false;
    
    u32 m_handle;
    
    u32 m_currentCommand;
    Alloc::AssetHandleFlexible m_resourceHandle;
    QueueType::Enum m_type = QueueType::GRAPHICS;
    u32 m_bufferSize = 0;
    
    bool m_baked = false;
};


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#include "commandBuffer.hpp"


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_CORE_END


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

