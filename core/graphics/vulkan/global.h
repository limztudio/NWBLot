// limztudio@gmail.com
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#pragma once


#include <core/global.h>

#include <core/graphics/common.h>

#if defined(NWB_PLATFORM_WINDOWS)
#define VK_USE_PLATFORM_WIN32_KHR
#elif defined(NWB_PLATFORM_LINUX)
#define VK_USE_PLATFORM_XCB_KHR
#elif defined(NWB_PLATFORM_ANDROID)
#define VK_USE_PLATFORM_ANDROID_KHR
#elif defined(NWB_PLATFORM_APPLE)
#define VK_USE_PLATFORM_METAL_EXT
#endif

#include <volk/volk.h>


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


#define NWB_VULKAN_BEGIN NWB_CORE_BEGIN namespace Vulkan{
#define NWB_VULKAN_END }; NWB_CORE_END


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_CORE_BEGIN


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


namespace ObjectTypes{
    constexpr ObjectType NWB_VK_Device = 0x00030101;
};


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_CORE_END


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_VULKAN_BEGIN


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


constexpr u64 s_DefaultUploadChunkSize = 64 * 1024 * 1024; // 64 MB
constexpr u64 s_DefaultScratchChunkSize = 16 * 1024 * 1024; // 16 MB
constexpr u64 s_ScratchMemoryLimit = 256 * 1024 * 1024; // 256 MB

constexpr u64 s_BufferAlignmentBytes = 4;


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


template<typename T, typename U>
inline T checked_cast(U u){
    static_assert(!std::is_same<T, U>::value, "Unnecessary checked_cast");
#ifdef NWB_DEBUG
    if(!u)
        return nullptr;
    T t = dynamic_cast<T>(u);
    NWB_ASSERT(t);
    return t;
#else
    if(!u)
        return nullptr;
    return static_cast<T>(u);
#endif
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


NWB_VULKAN_END


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

